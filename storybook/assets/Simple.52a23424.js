import{c as p,p as l,s as c,b as d,d as m,r as h,R as u,e as f,f as v}from"./PenrosePrograms.19febc7f.js";import{R as n}from"./index.5c77362b.js";import{j as t,a}from"./jsx-runtime.1c361ae2.js";async function o(i){const e=await fetch(i);if(!e.ok){console.error(`could not fetch ${i}`);return}return await e.text()}class y extends n.Component{canvasRef=n.createRef();penroseState=void 0;timerID=void 0;constructor(e){super(e);this.state={error:void 0}}compile=async()=>{this.penroseState=void 0;const e=await p(this.props);e.isOk()?this.penroseState=await l(e.value):this.setState({error:e.error})};converge=async()=>{if(this.penroseState){const e=c(this.penroseState);e.isOk()?this.penroseState=e.value:this.setState({error:e.error})}};tick=()=>{this.props.animate&&this.penroseState&&!d(this.penroseState)&&(this.penroseState=m(this.penroseState,this.props.stepSize??1),this.props.onFrame&&this.props.onFrame(this.penroseState),this.renderCanvas())};componentDidMount=async()=>{await this.compile(),this.props.animate||await this.converge(),this.renderCanvas(),this.timerID=window.setInterval(()=>this.tick(),1e3/60)};componentDidUpdate=async e=>{(this.props.domain!==e.domain||this.props.substance!==e.substance||this.props.style!==e.style)&&(await this.compile(),this.props.animate||await this.converge(),this.renderCanvas()),this.penroseState&&!this.state.error&&(this.props.variation!==e.variation||this.props.animate!==e.animate?(this.penroseState.variation=this.props.variation,this.penroseState=h(this.penroseState),this.props.animate||await this.converge(),this.renderCanvas()):this.props.interactive!==e.interactive&&this.renderCanvas())};componentWillUnmount=()=>{clearInterval(this.timerID)};renderCanvas=async()=>{if(this.canvasRef.current===null)return t("div",{children:"rendering..."});{const e=this.canvasRef.current;if(this.penroseState){const s=await(this.props.interactive===!1?u(this.penroseState,o):f(this.penroseState,async r=>{this.penroseState=r,this.props.animate||await this.converge(),this.renderCanvas()},o));e.firstChild!==null?e.replaceChild(s,e.firstChild):e.appendChild(s)}else console.log("state is undefined")}};render=()=>{const{error:e}=this.state;return a("div",{style:{width:"100%",height:"100%"},children:[!e&&t("div",{style:{width:"100%",height:"100%"},ref:this.canvasRef}),e&&a("div",{style:{padding:"1em",height:"100%"},children:[t("div",{style:{fontWeight:700},children:"1 error:"}),t("div",{style:{fontFamily:"monospace"},children:v(e).toString().split(`
`).map((s,r)=>t("p",{style:{margin:0},children:s},`err-ln-${r}`))})]})]})}}y.__docgenInfo={description:"",methods:[{name:"compile",docblock:null,modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},{name:"converge",docblock:null,modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},{name:"tick",docblock:null,modifiers:[],params:[],returns:null},{name:"componentDidMount",docblock:null,modifiers:["async"],params:[],returns:null},{name:"componentDidUpdate",docblock:null,modifiers:["async"],params:[{name:"prevProps",type:{name:"SimpleProps",alias:"SimpleProps"}}],returns:null},{name:"componentWillUnmount",docblock:null,modifiers:[],params:[],returns:null},{name:"renderCanvas",docblock:null,modifiers:["async"],params:[],returns:null},{name:"render",docblock:null,modifiers:[],params:[],returns:null}],displayName:"Simple",props:{domain:{required:!0,tsType:{name:"string"},description:""},substance:{required:!0,tsType:{name:"string"},description:""},style:{required:!0,tsType:{name:"string"},description:""},variation:{required:!0,tsType:{name:"string"},description:""},stepSize:{required:!1,tsType:{name:"number"},description:""},interactive:{required:!1,tsType:{name:"boolean"},description:""},animate:{required:!1,tsType:{name:"boolean"},description:""},onFrame:{required:!1,tsType:{name:"signature",type:"function",raw:"(frame: PenroseState) => void",signature:{arguments:[{name:"frame",type:{name:"PenroseState"}}],return:{name:"void"}}},description:""}}};export{y as S};
//# sourceMappingURL=Simple.52a23424.js.map
