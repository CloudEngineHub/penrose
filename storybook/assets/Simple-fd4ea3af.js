var re=Object.defineProperty;var se=(P,z,j)=>z in P?re(P,z,{enumerable:!0,configurable:!0,writable:!0,value:j}):P[z]=j;var A=(P,z,j)=>(se(P,typeof z!="symbol"?z+"":z,j),j);import{j as B}from"./jsx-runtime-1438501e.js";import{b as oe,R as ie,T as ae,A as ce,s as le,m as he,g as S,e as C,a as bt,o as I,u as Y,i as yt,t as U,c as J,d as x,f as K,r as St,_ as ue,h as et,j as pe,k as At,n as de,p as me,q as xt,v as ge,w as fe,x as we,y as ve,z as be,B as ye,C as Se,D as Ae,E as xe,F as ke,G as $e,H as Ee,__tla as Ce}from"./svg-81ee0d48.js";import{R as kt}from"./index-f46741a2.js";let nt,ze=Promise.all([(()=>{try{return Ce}catch{}})()]).then(async()=>{const P=()=>{const t=oe();ie(t);const n=new ae({packages:ce,macros:{textsc:["\\style{font-variant-caps: small-caps}{\\text{#1}}",1]},inlineMath:[["$","$"],["\\(","\\)"]],processEscapes:!0,formatError:(s,o)=>{throw Error(o.message)}}),r=new le.SVG({fontCache:"none"}),e=he.mathjax.document("",{InputJax:n,OutputJax:r});return s=>{try{const o=e.convert(s,{});return I(o.firstChild)}catch(o){return C(o.message)}}},z=t=>{const n=/^(\d+(?:\.\d+)?)\s*(px|in|cm|mm)$/,r=t.match(n);if(!r)return;const e=parseFloat(r[1]),s=r[2];return{number:e,unit:s}},j=(t,n)=>({px:1,in:96,cm:37.79527559055118,mm:3.7795275590551185})[n]*t,$t=async(t,n)=>new Promise(r=>{const e=S(t.string,""),s=S(t.fontSize,"");(s===""||e==="")&&r(C(`Label 'string' and 'fontSize' must be non-empty and non-optimized for ${t.name.contents}`));const o=n(e);if(o.isErr()){r(C(`MathJax could not render $${e}$: ${o.error}`));return}const i=o.value,a=i.getAttribute("viewBox");if(a===null){r(C(`No ViewBox found for MathJax output $${e}$`));return}const c=a.split(" "),h=parseFloat(c[2])/1e3,l=parseFloat(c[3])/1e3,u=-parseFloat(i.style.verticalAlign),p=parseFloat(i.getAttribute("height")),d=z(s);if(d){const{number:g,unit:f}=d,b=N=>N*j(g,f),y=b(h),v=b(l),w=u/p*v,m=v-w;r(I({body:i,width:y,height:v,descent:w,ascent:m}))}else{r(C('Invalid font size format. Only "px", "in", "cm", and "mm" units are supported.'));return}}),R=t=>({tag:"FloatV",contents:t}),rt=(t,n,r,e)=>({tag:"TextData",width:R(t),height:R(n),descent:R(r),ascent:R(e)}),Et=(t,n,r,e,s)=>({tag:"EquationData",width:R(t),height:R(n),ascent:R(r),descent:R(e),rendered:s}),st=t=>{const n=S(t.fontFamily),r=S(t.fontSize),e=S(t.fontStretch),s=S(t.fontStyle),o=S(t.fontVariant),i=S(t.fontWeight),a=S(t.lineHeight),c=`${e} ${s} ${o} ${i} ${r} ${n}`;return a!==""?c.concat(`/${a}`):c},ot=async(t,n)=>{const r=new Map;for(const e of t)if(e.shapeType==="Equation"){const s=S(e.name),o=await $t(e,n);if(o.isErr())return C({errorType:"SubstanceError",tag:"Fatal",message:o.error});const{body:i,width:a,height:c,ascent:h,descent:l}=o.value,u=Et(a===1/0?0:a,c===1/0?0:c,h,l,i);r.set(s,u)}else if(e.shapeType==="Text"){const s=S(e.name);let o;const i=Ct(S(e.string),st(e));i.width&&i.height?o=rt(i.width,i.height,i.actualDescent,i.actualAscent):o=rt(0,0,0,0),r.set(s,o)}else if(e.shapeType==="Group"){const s=bt(e.shapes),o=await ot(s,n);if(o.isErr())return o;for(const[i,a]of o.value.entries())r.set(i,a)}return I(r)};function Ct(t,n){const r=document.createElement("canvas"),e=r.getContext("2d");e.textBaseline="alphabetic",e.font=n;const s=e.measureText(t);return r.remove(),{width:Math.abs(s.actualBoundingBoxLeft)+Math.abs(s.actualBoundingBoxRight),height:Math.abs(s.actualBoundingBoxAscent)+Math.abs(s.actualBoundingBoxDescent),actualDescent:Math.abs(s.actualBoundingBoxDescent),actualAscent:Math.abs(s.actualBoundingBoxAscent)}}const D=(t,n,r,e)=>{if(typeof r.contents!="number"&&r.contents.tag==="Var"){const{index:s,meta:o}=Y(n.get(r.contents),()=>"missing input");o.init.tag==="Pending"&&(t[s]=e.contents)}},it=(t,n,r,e)=>{for(const s of t)if(s.shapeType==="Group"){const o=bt(s.shapes);it(o,n,r,e)}else if(s.shapeType==="Equation"){const o=Y(r.get(s.name.contents),()=>`missing label: ${s.name.contents}. Label cache: ${[...r.keys()].join(" ")}`);if(o.tag!=="EquationData")throw Error(`for ${s.shapeType} ${s.name.contents} got unexpected ${o.tag}`);D(n,e,s.width,o.width),D(n,e,s.height,o.height),D(n,e,s.ascent,o.ascent),D(n,e,s.descent,o.descent)}else if(s.shapeType==="Text"){const o=Y(r.get(s.name.contents),()=>`missing label: ${s.name.contents}`);if(o.tag!=="TextData")throw Error(`for ${s.shapeType} ${s.name.contents} got unexpected ${o.tag}`);D(n,e,s.width,o.width),D(n,e,s.height,o.height),D(n,e,s.ascent,o.ascent),D(n,e,s.descent,o.descent)}},at=t=>{const n=[...t.varyingValues],r=new Map(t.inputs.map(({handle:e,meta:s},o)=>[e,{index:o,meta:s}]));return it(t.shapes,n,t.labelCache,r),{...t,varyingValues:n}},ct={accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",overlinePosition:"overline-position",overlineThickness:"overline-thickness",panose1:"panose-1",paintOrder:"paint-order",pointerEvents:"pointer-events",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDasharray:"stroke-dasharray",strokeDashoffset:"stroke-dashoffset",strokeLinecap:"stroke-linecap",strokeLinejoin:"stroke-linejoin",strokeMiterlimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode"},k=(t,n,r)=>{const e=["name","ensureOnCanvas"],s=new Set(r.concat(e));for(const[o,i]of t.passthrough)if(!(i.tag==="StrV"&&i.contents===""||s.has(o)))if(yt(o,ct)){const a=ct[o];n.hasAttribute(a)||n.setAttribute(a,i.contents.toString())}else if(o==="style"&&i.contents!==""){const a=n.getAttribute(o);a===null?n.setAttribute(o,i.contents.toString()):n.setAttribute(o,`${a}${i.contents.toString()}`)}else n.hasAttribute(o)||n.setAttribute(o,i.contents.toString())},T=(t,n)=>{const r=t.fillColor,e=U(r.contents);return n.setAttribute("fill",J(r.contents)),r.contents.tag!=="NONE"&&n.setAttribute("fill-opacity",e.toString()),["fillColor"]},lt=(t,n,r)=>{const e=t.center,[s,o]=x([e.contents[0],e.contents[1]],n);return r.setAttribute("cx",s.toString()),r.setAttribute("cy",o.toString()),["center"]},ht=(t,n)=>{let r=t.scale.contents;r=r||1;let e=n.getAttribute("transform");return e=e===null?`scale(${r})`:e+`scale{${r}}`,n.setAttribute("transform",e),["scale"]},ut=(t,n,r)=>{const e=t.center,[s,o]=x([e.contents[0],e.contents[1]],n),i=t.width,a=t.height;let c=r.getAttribute("transform");return c=c===null?`translate(${s-i.contents/2}, ${o-a.contents/2})`:c+`translate(${s-i.contents/2}, ${o-a.contents/2})`,r.setAttribute("transform",c),["center","width","height"]},zt=(t,n,r)=>{const e=t.center,[s,o]=x([e.contents[0],e.contents[1]],n),i=t.width,a=t.height;return r.setAttribute("x",(s-i.contents/2).toString()),r.setAttribute("y",(o-a.contents/2).toString()),["center","width","height"]},O=(t,n,r)=>{t.width,t.height;const e=t.center,s=t.rotation.contents,[o,i]=x([e.contents[0],e.contents[1]],n);let a=r.getAttribute("transform");return a=a===null?`rotate(${s}, ${o}, ${i})`:a+`rotate(${s}, ${o}, ${i})`,r.setAttribute("transform",a),["rotation","center","width","height"]},F=(t,n)=>{const r=t.width,e=t.height;return n.setAttribute("width",Math.max(r.contents,0).toString()),n.setAttribute("height",Math.max(e.contents,0).toString()),["width","height"]},Tt=(t,n)=>{const r=t.cornerRadius;return n.setAttribute("rx",r.contents.toString()),["cornerRadius"]},Nt=(t,n)=>{const r=t.string,e=document.createTextNode(r.contents.toString());return n.appendChild(e),["string"]},Bt="7,5",V=(t,n)=>{const r=[],e=t.strokeColor,s=U(e.contents),o=t.strokeWidth.contents;return n.setAttribute("stroke",J(e.contents)),r.push("strokeColor","strokeWidth"),e.contents.tag!=="NONE"&&(n.setAttribute("stroke-opacity",s.toString()),n.setAttribute("stroke-width",o.toString()),"strokeDasharray"in t&&t.strokeDasharray.contents!==""?(n.setAttribute("stroke-dasharray",t.strokeDasharray.contents),r.push("strokeDasharray")):"strokeStyle"in t&&t.strokeStyle.contents==="dashed"&&(n.setAttribute("stroke-dasharray",Bt.toString()),r.push("strokeDasharray","strokeStyle")),"strokeLinecap"in t&&t.strokeLinecap.contents!==""&&(n.setAttribute("stroke-linecap",t.strokeLinecap.contents),r.push("strokeLinecap"))),r},$=(t,n)=>{const r=t.name,e=document.createElementNS("http://www.w3.org/2000/svg","title");return e.textContent=r.contents,n.appendChild(e),["name"]},Rt=(t,n)=>{const r=st(t),e=n.getAttribute("style");return n.setAttribute("style",e?`${e}; font: ${r};`:`font: ${r};`),["fontFamily","fontSize","fontStretch","fontStyle","fontVariant","fontWeight","lineHeigh"]},pt=(t,n,r)=>{const e=t.points.contents.map(s=>x([s[0],s[1]],n));return r.setAttribute("points",e.toString()),["points"]},Dt=(t,{canvasSize:n})=>{const r=document.createElementNS("http://www.w3.org/2000/svg","circle"),e=[];return e.push(...T(t,r)),e.push(...lt(t,n,r)),e.push(...V(t,r)),e.push(...$(t,r)),r.setAttribute("r",Math.max(0,t.r.contents).toString()),e.push("r"),k(t,r,e),r},Vt=(t,{canvasSize:n})=>{const r=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),e=[];return e.push(...T(t,r)),e.push(...lt(t,n,r)),e.push(...V(t,r)),e.push(...$(t,r)),r.setAttribute("rx",Math.max(t.rx.contents,0).toString()),e.push("rx"),r.setAttribute("ry",Math.max(t.ry.contents,0).toString()),e.push("ry"),k(t,r,e),r},Q=(t,[n,r],e)=>{const s=document.createElementNS("http://www.w3.org/2000/svg","text");return s.textContent=t,T(e,s),F(e,s),s.setAttribute("x",`${n}`),s.setAttribute("y",`${r}`),s.setAttribute("alignment-baseline","alphabetic"),s.setAttribute("dominant-baseline","alphabetic"),s.setAttribute("text-anchor","middle"),s},Mt=(t,n)=>{const{canvasSize:r,labels:e,texLabels:s}=n,{center:o}=t,[i,a]=x([o.contents[0],o.contents[1]],r);if(s){const u=a+t.height.contents/2-t.descent.contents;let p=Q(`$${S(t.string)}$`,[i,u],t);for(const[d,g]of t.passthrough)d==="texContourColor"&&g.contents!==""&&(p=Q(`\\contour{${g.contents}}{$${S(t.string)}$}`,[i,u],t));return p}const c=document.createElementNS("http://www.w3.org/2000/svg","g"),h=[];h.push(...O(t,r,c)),h.push(...ut(t,r,c)),h.push(...$(t,c));const l=e.get(S(t.name));if(l&&l.tag==="EquationData"){const u=l.rendered.cloneNode(!0),p=u.getElementsByTagName("g")[0];h.push(...T(t,p)),h.push(...F(t,u)),p.setAttribute("stroke","none"),p.setAttribute("stroke-width","0");const d=t.fontSize;return u.setAttribute("style",`font-size: ${d.contents}`),c.appendChild(u),k(t,c,h),c}else return Q(S(t.string),[i,a],t)},Pt=`<?xml version="1.0" encoding="UTF-8"?>
<svg id="uuid-14337243-9689-41d7-b7ce-2960e3a1016a" data-name="uuid-95bf6e06-fb2b-43f6-8f44-0afdfcaaf242" xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200">
  <polygon points="132.5 2.1 175.7 45.3 175.7 197.9 24.3 197.9 24.3 2.1 132.5 2.1" style="fill: #e0e0e0; stroke: #7f7f7f; stroke-width: 4.039px;"/>
  <g>
    <path d="m157.4,77.75l-46.2-33.4-42.1,30.4m42.2-46.9l-46.4,33.5,15.7,49.1m38.2,0h-51.4l-18-54.1m7.8,66.9h57.1l17.1-48.4m-7.3,62l17.9-54.1-42.2-30.9m38,85H61.6l-23.4-72.3,61.5-44.9,62.1,44.9-24,72.3Z" style="fill: none; stroke: #ffb6b6; stroke-width: 4.034px;"/>
    <path d="m77,66.3c0-3.4.5-6.5,1.4-9.4s2.3-5.3,4.2-7.3c1.8-2,4.2-3.6,7-4.8s6.1-1.7,9.7-1.7c8,0,13.9,2,17.9,5.9,3.9,3.9,5.9,9.2,5.9,15.8,0,3.2-.5,6.1-1.5,8.8s-2.9,5.6-5.6,8.8l-4.5,5.1c-2,2.2-3.4,4.2-4.2,6-.9,1.8-1.3,4.1-1.3,7h0c0,.9-.8,1.7-1.7,1.7h-10.7c-.9,0-1.7-.8-1.7-1.7v-2.7c0-3.8.5-6.9,1.6-9.5s2.9-5.3,5.4-8.2l4.3-4.8c1.6-1.7,2.7-3.6,3.3-5.6.6-2,1-4.1,1-6.4,0-2.9-.6-5.2-1.9-6.9-1.3-1.8-3.2-2.6-5.7-2.6-2.9,0-4.9,1.1-6.1,3.4-1.2,2.3-1.9,5.3-1.9,9v1.1c0,.9-.8,1.7-1.7,1.7h-11.6c-.9,0-1.7-.8-1.7-1.7v-1h.1Zm28,58.1h-12.2c-.9,0-1.7-.8-1.7-1.7v-11.5c0-.9.8-1.7,1.7-1.7h12.2c.9,0,1.7.8,1.7,1.7v11.5c0,1-.8,1.7-1.7,1.7Z" style="fill: red;"/>
  </g>
  <g style="isolation: isolate;">
    <g style="isolation: isolate;">
      <path d="m58.52,179.451h-8.066v-9.533h8.066v9.533Z"/>
      <path d="m70.802,169.795c0,1.427.376,2.577,1.131,3.453.753.876,1.843,1.313,3.269,1.313,1.303,0,2.342-.325,3.117-.978.773-.651,1.161-1.629,1.161-2.934,0-1.059-.306-1.863-.917-2.414-.611-.55-1.324-.987-2.139-1.313l-5.928-2.139c-2.322-.814-4.074-1.965-5.255-3.453-1.182-1.486-1.772-3.392-1.772-5.713,0-1.345.224-2.617.672-3.819.448-1.201,1.161-2.251,2.139-3.147.978-.896,2.23-1.609,3.758-2.139s3.371-.795,5.53-.795c3.829,0,6.661.815,8.494,2.444,1.833,1.63,2.75,3.933,2.75,6.905v1.345h-7.578c0-1.711-.275-2.964-.825-3.758-.55-.795-1.519-1.192-2.903-1.192-1.06,0-1.986.296-2.781.887-.794.591-1.191,1.477-1.191,2.658,0,.815.254,1.549.764,2.199.509.652,1.477,1.202,2.903,1.65l5.072,1.711c2.647.896,4.522,2.068,5.622,3.514,1.1,1.447,1.65,3.413,1.65,5.897,0,1.752-.306,3.27-.917,4.553-.611,1.283-1.457,2.353-2.536,3.208-1.08.855-2.363,1.467-3.85,1.833-1.488.367-3.127.55-4.919.55-2.363,0-4.329-.224-5.897-.672-1.569-.448-2.811-1.12-3.728-2.017-.917-.896-1.558-1.986-1.925-3.27s-.55-2.719-.55-4.308v-1.161h7.578v1.1Z"/>
      <path d="m115.778,146.574l-8.25,32.877h-9.778l-8.494-32.877h8.8l4.705,23.527h.123l4.461-23.527h8.434Z"/>
      <path d="m143.52,177.8c0,4.237-1.049,7.415-3.146,9.533-2.099,2.118-5.612,3.178-10.541,3.178-3.586,0-6.347-.764-8.28-2.291-1.936-1.528-2.903-3.697-2.903-6.509h8.066c0,1.06.428,1.895,1.283,2.506.407.284.846.509,1.314.672.468.162.967.245,1.497.245,1.711,0,2.912-.551,3.605-1.65.692-1.1,1.038-2.466,1.038-4.095v-4.338h-.122c-.855,1.222-1.904,2.199-3.146,2.933-1.243.733-2.536,1.101-3.881,1.101-3.341,0-5.856-1.273-7.547-3.819-1.691-2.546-2.536-6.814-2.536-12.803,0-1.914.112-3.87.336-5.866s.692-3.799,1.406-5.408c.712-1.609,1.751-2.923,3.116-3.941,1.364-1.019,3.188-1.528,5.469-1.528,1.182,0,2.403.327,3.667.978,1.263.652,2.301,1.834,3.116,3.545h.122v-3.667h8.066v31.227Zm-16.713-10.511c.102,1.02.306,1.926.611,2.72.306.795.733,1.427,1.283,1.895.55.469,1.272.703,2.169.703s1.64-.234,2.23-.703c.591-.468,1.06-1.109,1.406-1.925.345-.814.59-1.803.732-2.964s.214-2.434.214-3.819c0-3.992-.315-6.823-.946-8.494-.633-1.67-1.783-2.506-3.453-2.506-.938,0-1.691.205-2.261.611-.571.408-1.02,1.069-1.345,1.986-.326.916-.54,2.139-.642,3.666-.103,1.528-.152,3.392-.152,5.592,0,1.141.05,2.221.152,3.238Z"/>
    </g>
  </g>
  <polygon points="175.7 45.3 132.5 45.3 132.5 2.1 175.7 45.3" style="fill: #e0e0e0; stroke: #7f7f7f; stroke-linecap: round; stroke-linejoin: round; stroke-width: 4.039px;"/>
  <rect width="200" height="200" style="fill: none;"/>
</svg>`;let jt=1;const It=(t,n)=>{const r="--inject-",e={clipPath:["clip-path"],"color-profile":null,cursor:null,filter:null,linearGradient:["fill","stroke"],marker:["marker","marker-end","marker-mid","marker-start"],mask:null,pattern:["fill","stroke"],radialGradient:["fill","stroke"]},s=r+jt++,o=/url\("?#([a-zA-Z][\w:.-]*)"?\)/g,i=t.querySelectorAll("[id]");let a;const c=n?new Set:void 0,h=new Set,l=[];let u=!1,p,d;if(i.length){for(p=0;p<i.length;p++){const w=i[p].localName;yt(w,e)&&h.add(w)}h.forEach(w=>{(e[w]||[w]).forEach(function(m){l.indexOf(m)<0&&l.push(m)})}),l.length&&l.push("style");const g=t.getElementsByTagName("*");let f=t,b,y,v;for(p=-1;f!==null;){if(f.localName==="style")y=f.textContent,v=y&&y.replace(o,function(w,m){return c&&c.add(m),"url(#"+m+s+")"}),v!==y&&(f.textContent=v);else if(f.hasAttributes()){for(d=0;d<l.length;d++)b=l[d],y=f.getAttribute(b),v=y&&y.replace(o,function(w,m){return c&&c.add(m),"url(#"+m+s+")"}),v&&v!==y&&f.setAttribute(b,v);for(const w of["xlink:href","href"]){let m=f.getAttribute(w);m&&/^\s*#/.test(m)&&(m=m.trim(),f.setAttribute(w,m+s),c&&c.add(m.substring(1)))}}f=g.item(++p)}for(p=0;p<i.length;p++)a=i[p],(!c||c.has(a.id))&&(a.id+=s,u=!0)}return u},qt=async(t,{canvasSize:n,pathResolver:r})=>{const e=document.createElementNS("http://www.w3.org/2000/svg","g"),s=[],o=t.href.contents;let i=await r(o);i===void 0&&(console.error(`Could not resolve image path ${o}`),i=Pt),s.push("href"),e.innerHTML=i;const a=e.querySelector("svg");return It(e,!1),s.push(...F(t,a)),s.push(...O(t,n,e)),s.push(...ut(t,n,e)),s.push(...$(t,e)),a.setAttribute("preserveAspectRatio",t.preserveAspectRatio.contents),s.push("preserveAspectRatio"),k(t,e,s),e},L=(t,n,r,e,s,o)=>{const i=document.createElementNS("http://www.w3.org/2000/svg","marker");i.setAttribute("id",t),i.setAttribute("markerUnits","strokeWidth"),i.setAttribute("markerWidth",St(e.width*s).toString()),i.setAttribute("markerHeight",St(e.height*s).toString()),i.setAttribute("viewBox",e.viewbox),i.setAttribute("refX",e.refX.toString()),i.setAttribute("refY",e.refY.toString()),o?i.setAttribute("orient","auto"):i.setAttribute("orient","auto-start-reverse");const a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("d",e.path),e.fillKind==="stroke"?(a.setAttribute("fill","none"),i.setAttribute("stroke",n),i.setAttribute("stroke-opacity",r.toString())):(a.setAttribute("fill",n),a.setAttribute("fill-opacity",r.toString())),e.style&&Object.entries(e.style).forEach(([c,h])=>{a.setAttribute(c,h)}),i.appendChild(a),i},Ft=(t,n,r)=>{const e=[],[s,o]=[t.start.contents[0],t.start.contents[1]],[i,a]=[t.end.contents[0],t.end.contents[1]],c=t.startArrowheadSize.contents,h=t.endArrowheadSize.contents,l=t.strokeWidth.contents;e.push("start","end","startArrowhead","endArrowhead","startArrowheadSize","endArrowheadSize","strokeWidth");const u=Math.sqrt((s-i)**2+(o-a)**2);if(u===0)return[[[s,o],[i,a]],e];let p,d;if(n){const b=(t.flipStartArrowhead.contents?n.refX:n.width-n.refX)*c*l,y=b/u*(s-i),v=b/u*(o-a);[p,d]=[s-y,o-v]}else[p,d]=[s,o];let g,f;if(r){const b=(r.width-r.refX)*h*l;[g,f]=[i-b/u*(i-s),a-b/u*(a-o)]}else[g,f]=[i,a];return[[[p,d],[g,f]],e]},Ot=(t,{canvasSize:n,namespace:r,variation:e})=>{const s=K(t.startArrowhead.contents),o=K(t.endArrowhead.contents),[[[i,a],[c,h]],l]=Ft(t,s,o),u=J(t.strokeColor.contents),p=U(t.strokeColor.contents),d=document.createElementNS("http://www.w3.org/2000/svg","g"),g=document.createElementNS("http://www.w3.org/2000/svg","line"),[f,b]=x([i,a],n),[y,v]=x([c,h],n);g.setAttribute("x1",f.toString()),g.setAttribute("y1",b.toString()),g.setAttribute("x2",y.toString()),g.setAttribute("y2",v.toString());const w=`${r}-${e}-${t.name.contents}`,m=w+"-startArrowId",N=w+"-endArrowId";if(s){const M=t.startArrowheadSize.contents,q=t.flipStartArrowhead.contents;d.appendChild(L(m,u,p,s,M,q))}if(o){const M=t.endArrowheadSize.contents;d.appendChild(L(N,u,p,o,M,!1))}return l.push("startArrowhead","flipStartArrowhead","endArrowhead","startArrowheadSize","endArrowheadSize"),l.push(...V(t,g)),s&&(g.setAttribute("marker-start",`url(#${m})`),l.push("startArrowhead")),o&&(g.setAttribute("marker-end",`url(#${N})`),l.push("endArrowhead")),d.appendChild(g),l.push(...$(t,d)),k(t,d,l),d},Lt=(t,n)=>t.map(r=>{const{cmd:e,contents:s}=r;if(s.length===0&&e!=="Z")return console.error("WARNING: empty path"),"";const o=ue.flatten(s.map(i=>{switch(i.tag){case"CoordV":return x([i.contents[0],i.contents[1]],n);case"ValueV":return i.contents}})).join(" ");return`${e} ${o}`}).join(" "),Wt=(t,{canvasSize:n})=>{const r=J(t.strokeColor.contents),e=U(t.strokeColor.contents),s=[],o=document.createElementNS("http://www.w3.org/2000/svg","path");s.push(...T(t,o)),s.push(...V(t,o)),o.setAttribute("d",Lt(t.d.contents,n)),s.push("d");let i;const a=K(t.startArrowhead.contents),c=K(t.endArrowhead.contents);if(a||c){const h=document.createElementNS("http://www.w3.org/2000/svg","g"),l=t.name.contents+"-startArrowId",u=t.name.contents+"-endArrowId";if(a){const p=t.name.contents+"-startArrowId",d=t.startArrowheadSize.contents,g=t.flipStartArrowhead.contents;h.appendChild(L(p,r,e,a,d,g))}if(c){const p=t.name.contents+"-endArrowId",d=t.endArrowheadSize.contents;h.appendChild(L(p,r,e,c,d,!1))}s.push("name","startArrowhead","flipStartArrowhead","endArrowhead"),a&&(o.setAttribute("marker-start",`url(#${l})`),s.push("startArrowhead")),c&&(o.setAttribute("marker-end",`url(#${u})`),s.push("endArrowhead")),h.appendChild(o),i=h}else i=o;return s.push(...$(t,i)),k(t,i,s),i},Xt=(t,{canvasSize:n})=>{const r=document.createElementNS("http://www.w3.org/2000/svg","polygon"),e=[];return e.push(...T(t,r)),e.push(...V(t,r)),e.push(...$(t,r)),e.push(...ht(t,r)),e.push(...pt(t,n,r)),k(t,r,e),r},Gt=(t,{canvasSize:n})=>{const r=document.createElementNS("http://www.w3.org/2000/svg","polyline"),e=[];return e.push(...T(t,r)),e.push(...V(t,r)),e.push(...$(t,r)),e.push(...ht(t,r)),e.push(...pt(t,n,r)),k(t,r,e),r},Ht=(t,{canvasSize:n})=>{const r=document.createElementNS("http://www.w3.org/2000/svg","rect"),e=[];return e.push(...zt(t,n,r)),e.push(...F(t,r)),e.push(...T(t,r)),e.push(...V(t,r)),e.push(...$(t,r)),e.push(...Tt(t,r)),e.push(...O(t,n,r)),k(t,r,e),r},Zt=(t,{canvasSize:n,labels:r})=>{const e=document.createElementNS("http://www.w3.org/2000/svg","text"),s=[];s.push("x","y"),s.push(...T(t,e)),s.push(...V(t,e)),s.push(...$(t,e)),s.push(...Nt(t,e)),s.push(...O(t,n,e)),s.push(...Rt(t,e));const o=t.name,i=r.get(o.contents),a=t.center,[c,h]=x([a.contents[0],a.contents[1]],n);if(i&&i.tag==="TextData"){const l=i.descent.contents,u=i.height.contents,p=h+(u/2-l);e.setAttribute("x",c.toString()),e.setAttribute("y",p.toString()),s.push(...F(t,e))}else e.setAttribute("x",c.toString()),e.setAttribute("y",h.toString());return e.setAttribute("font-size-adjust",t.fontSizeAdjust.contents),e.setAttribute("alignment-baseline",t.alignmentBaseline.contents),e.setAttribute("dominant-baseline",t.dominantBaseline.contents),e.setAttribute("ascent",t.ascent.contents.toString()),e.setAttribute("descent",t.descent.contents.toString()),e.setAttribute("text-anchor",t.textAnchor.contents.toString()),e.setAttribute("visibility",t.visibility.contents),s.push("fontSizeAdjust","alignmentBaseline","dominantBaseline","ascent","descent","textAnchor","visibility"),k(t,e,s),e},_t=(t,n,r,e)=>{const s=[...t.varyingValues];return{...t,params:et(s.length),varyingValues:s}},dt=({clientX:t,clientY:n},r)=>{const e=r.getScreenCTM();return e!==null?{x:(t-e.e)/e.a,y:(n-e.f)/e.d}:{x:0,y:0}},Yt=async(t,n,r,e)=>{const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("xmlns","http://www.w3.org/2000/svg"),s.setAttribute("version","1.2"),s.setAttribute("viewBox",`0 0 ${t.canvas.width} ${t.canvas.height}`);const o=(a,c,h)=>{n(_t(t))},i=t.computeShapes(t.varyingValues);return await mt(i,s,{labels:t.labelCache,canvasSize:t.canvas.size,variation:t.variation,namespace:e,texLabels:!1,pathResolver:r},{updateState:n,onDrag:o,parentSVG:s}),s},Ut=async({varyingValues:t,canvas:n,computeShapes:r,labelCache:e,variation:s},o,i,a=!1)=>{const c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.setAttribute("version","1.2"),c.setAttribute("xmlns","http://www.w3.org/2000/svg"),c.setAttribute("viewBox",`0 0 ${n.width} ${n.height}`);const h=r(t),l=h.map(E=>pe(E)),u=At(l.map(E=>de(E))),p=At(l.map(E=>me(E))),d=xt(l.map(E=>ge(E))),g=xt(l.map(E=>fe(E))),f=[u,p,d,g],[b,y,v,w]=(await we(f))(E=>E.val),[m,N]=x([b,y],[n.width,n.height]),[M,q]=x([v,w],[n.width,n.height]),G=[m,q],H=[M-m,N-q];c.setAttribute("penrose","0");const Z=document.createElementNS("https://penrose.cs.cmu.edu/metadata","penrose"),_=document.createElementNS("https://penrose.cs.cmu.edu/croppedViewBox","croppedViewBox");return _.insertAdjacentText("afterbegin",`${G[0]} ${G[1]} ${H[0]} ${H[1]}`),Z.appendChild(_),c.appendChild(Z),await mt(h,c,{labels:e,canvasSize:n.size,variation:s,namespace:i,texLabels:a,pathResolver:o},void 0),c},Jt=async(t,n,r)=>{const e=document.createElementNS("http://www.w3.org/2000/svg","g"),s=t.clipPath.contents;let o,i;if(s.tag==="Clip"){const c=s.contents;o=c.name.contents;const h=await W(c,n,r),l=document.createElementNS("http://www.w3.org/2000/svg","clipPath");i=n.namespace+o+"-clip",l.setAttribute("id",i),l.appendChild(h),e.appendChild(l)}const a=t.shapes.contents;for(const c of a){const h=c.name.contents;if(s.tag==="Clip"){if(h!==o){const l=await W(c,n,r),u=document.createElementNS("http://www.w3.org/2000/svg","g");u.appendChild(l),u.setAttribute("clip-path",`url(#${i})`),e.appendChild(u)}}else{const l=await W(c,n,r);e.appendChild(l)}}return k(t,e,[...$(t,e),"shapes","clipPath"]),e},Kt=async(t,n)=>{switch(t.shapeType){case"Circle":return Dt(t,n);case"Ellipse":return Vt(t,n);case"Equation":return Mt(t,n);case"Image":return qt(t,n);case"Line":return Ot(t,n);case"Path":return Wt(t,n);case"Polygon":return Xt(t,n);case"Polyline":return Gt(t,n);case"Rectangle":return Ht(t,n);case"Text":return Zt(t,n)}},W=async(t,n,r)=>{if(t.shapeType==="Group")return await Jt(t,n,r);{const e=await Kt(t,n);if(r){const s=document.createElementNS("http://www.w3.org/2000/svg","g");ve(t)?s.setAttribute("pointer-events","visibleStroke"):be(t)?s.setAttribute("pointer-events","bounding-box"):s.setAttribute("pointer-events","auto"),s.appendChild(e);const o=i=>{const{clientX:a,clientY:c}=i,{x:h,y:l}=dt({clientX:a,clientY:c},r.parentSVG),{width:u,height:p,x:d,y:g}=i.target.getBBox({stroke:!0}),f=h-d,b=n.canvasSize[0]-u+(h-d),y=l-g,v=n.canvasSize[1]-p+(l-g);s.setAttribute("opacity","0.5");let w=0,m=0;const N=q=>{const{x:G,y:H}=dt(q,r.parentSVG),Z=gt(G,f,b),_=gt(H,y,v);w=Z-h,m=l-_,s.setAttribute("transform",`translate(${w},${-m})`)},M=()=>{s.setAttribute("opacity","1"),document.removeEventListener("mouseup",M),document.removeEventListener("mousemove",N),r.onDrag(t.name.contents,w,m)};document.addEventListener("mouseup",M),document.addEventListener("mousemove",N)};return s.addEventListener("mousedown",o),s}else return e}},mt=async(t,n,r,e)=>{for(const s of t){const o=await W(s,r,e);n.appendChild(o)}},gt=(t,n,r)=>Math.min(Math.max(t,n),r),Qt=t=>{const n=ye(t.variation);return at({...t,varyingValues:t.inputs.map(({meta:r})=>r.init.tag==="Sampled"?r.init.sampler(n):r.init.pending),currentStageIndex:0,params:et(t.varyingValues.length)})},ft=(t,n)=>{const{constraintSets:r,optStages:e,currentStageIndex:s}=t,o=e[s],i=Y(r.get(o),()=>`missing stage: ${o}`),a=new Float64Array(t.varyingValues),c=ke((h,l,u)=>t.gradient(i,h,l,u).phi,a,t.params,n.until);return c.optStatus==="Error"?C({errorType:"RuntimeError",...$e("",t)}):I({...t,varyingValues:Array.from(a),params:c})},te=(t,n=1e4)=>{let r=0;const e=ft(t,{until:()=>r++>=n});if(e.isErr())return e;{const s=e.value;if(X(s)&&!tt(s)){const o=wt(s);return I(o)}else return e}},wt=t=>tt(t)?t:{...t,currentStageIndex:t.currentStageIndex+1,params:et(t.varyingValues.length)},ee=t=>{let n=t;for(;!X(n)||!tt(n);){X(n)&&(n=wt(n));const r=ft(n,{until:()=>!1});if(r.isOk())n=r.value;else return r}return I(n)},ne=async t=>{const n=Se(t.domain);if(n.isErr())return C(n.error);const r=Ae(t.substance,n.value);if(r.isErr())return C(r.error);const e=await xe(t.variation,t.style,t.excludeWarnings??[],r.value,n.value);if(e.isErr())return e;{const s=e.value,o=P(),i=await ot(s.shapes,o);return i.isErr()?C(i.error):I(at({...s,labelCache:i.value}))}},X=t=>t.params.optStatus==="EPConverged",tt=t=>t.currentStageIndex===t.optStages.length-1;async function vt(t){const n=await fetch(t);if(!n.ok){console.error(`could not fetch ${t}`);return}return await n.text()}nt=class extends kt.Component{constructor(n){super(n);A(this,"canvasRef",kt.createRef());A(this,"penroseState");A(this,"timerID");A(this,"compile",async()=>{this.penroseState=void 0,this.setState({error:void 0});const n=await ne(this.props);n.isOk()?(this.penroseState=n.value,this.setState({error:void 0})):this.setState({error:n.error})});A(this,"converge",async()=>{if(this.penroseState){const n=ee(this.penroseState);n.isOk()?this.penroseState=n.value:this.setState({error:n.error})}});A(this,"tick",()=>{if(this.props.animate&&this.penroseState&&!X(this.penroseState)){const n=te(this.penroseState,this.props.stepSize??1);n.isErr()?this.setState({error:n.error}):this.penroseState=n.value,this.renderCanvas()}});A(this,"componentDidMount",async()=>{await this.compile(),this.props.animate||await this.converge(),this.renderCanvas(),this.timerID=window.setInterval(()=>this.tick(),1e3/60)});A(this,"componentDidUpdate",async n=>{if(this.props.domain!==n.domain||this.props.substance!==n.substance||this.props.style!==n.style){await this.compile(),this.props.animate||await this.converge(),this.renderCanvas();return}if(this.penroseState&&!this.state.error){if(this.props.variation!==n.variation||this.props.animate!==n.animate){this.penroseState.variation=this.props.variation,this.penroseState=Qt(this.penroseState),this.props.animate||await this.converge(),this.renderCanvas();return}else if(this.props.interactive!==n.interactive){this.renderCanvas();return}}});A(this,"componentWillUnmount",()=>{clearInterval(this.timerID)});A(this,"renderCanvas",async()=>{if(this.canvasRef.current===null)return B.jsx("div",{children:"rendering..."});{const n=this.canvasRef.current;if(this.penroseState){const r=await(this.props.interactive===!1?Ut(this.penroseState,this.props.imageResolver??vt,this.props.name??""):Yt(this.penroseState,async e=>{this.penroseState=e,this.props.animate||await this.converge(),this.renderCanvas()},this.props.imageResolver??vt,this.props.name??""));r.setAttribute("width","100%"),r.setAttribute("height","100%"),n.firstChild!==null?n.replaceChild(r,n.firstChild):n.appendChild(r),this.props.onFrame&&this.props.onFrame(this.penroseState)}else return B.jsx("div",{children:"rendering..."})}});A(this,"render",()=>{const{error:n}=this.state;return B.jsxs(B.Fragment,{children:[!n&&B.jsx("div",{style:{width:"100%",height:"100%"},ref:this.canvasRef}),n&&B.jsxs("div",{style:{padding:"1em",height:"100%"},children:[B.jsx("div",{style:{fontWeight:700},children:"1 error:"}),B.jsx("div",{style:{fontFamily:"monospace"},children:Ee(n).toString().split(`
`).map((r,e)=>B.jsx("p",{style:{margin:0},children:r},`err-ln-${e}`))})]})]})});this.state={error:void 0}}},nt.__docgenInfo={description:"",methods:[{name:"compile",docblock:null,modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},{name:"converge",docblock:null,modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},{name:"tick",docblock:null,modifiers:[],params:[],returns:null},{name:"componentDidMount",docblock:null,modifiers:["async"],params:[],returns:null},{name:"componentDidUpdate",docblock:null,modifiers:["async"],params:[{name:"prevProps",optional:!1,type:{name:"SimpleProps",alias:"SimpleProps"}}],returns:null},{name:"componentWillUnmount",docblock:null,modifiers:[],params:[],returns:null},{name:"renderCanvas",docblock:null,modifiers:["async"],params:[],returns:null},{name:"render",docblock:null,modifiers:[],params:[],returns:null}],displayName:"Simple",props:{domain:{required:!0,tsType:{name:"string"},description:""},substance:{required:!0,tsType:{name:"string"},description:""},style:{required:!0,tsType:{name:"string"},description:""},variation:{required:!0,tsType:{name:"string"},description:""},excludeWarnings:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},stepSize:{required:!1,tsType:{name:"number"},description:""},interactive:{required:!1,tsType:{name:"boolean"},description:""},animate:{required:!1,tsType:{name:"boolean"},description:""},onFrame:{required:!1,tsType:{name:"signature",type:"function",raw:"(frame: PenroseState) => void",signature:{arguments:[{type:{name:"PenroseState"},name:"frame"}],return:{name:"void"}}},description:""},imageResolver:{required:!1,tsType:{name:"PathResolver"},description:""},name:{required:!1,tsType:{name:"string"},description:""}}}});export{nt as S,ze as __tla};
